<script>
   $(function () {
     $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<div class="container-fluid">
  <div class="row">
    <div class="col-lg-1"></div>
    <div class="col-lg-10">
      <div class="tim-title" style="margin-bottom: 1rem;">
        <p class="h2">User List</p>
        <div class="row">
          <div class="col-md-4">
            <div class="card">
              <div class="card-body">
                <%= form_tag users_path, method: :get do %>
                  <%= text_field_tag :searchname, params[:searchname] %>
                  <%= submit_tag 'Search', class: "btn btn-primary" %>
                <% end %>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card">
              <div class="card-body">
                <div class="digg_pagination" style="height: <%= @users.total_pages > 1 ? "80px" : "36px"  %>">
                  <div class="page_info">
                    <%= page_entries_info @users %>
                  </div>
                  <%= will_paginate @users, :container => false, :inner_window => 2, :outer_window => 1 %>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-body">
                <% @users.each do |user| %>
                  <div class="avatarWithName">
                    <div class="avatarUserName"><%= user.username %></div>
                    <a href=<%="users/#{user.id}"%>>
                      <span class="fullSizeAvatar">
                        <%= image_tag user.profile_picture, :title => "#{frequency_string(user.current_dad_frequency, true)}", :alt => "#{user.username}", :data => { :toggle => "tooltip", :placement => "top" } %>
                        <div style="margin-top: 5px;" data-toggle="tooltip" data-placement="top" title="Record Streak: <%= user.longest_streak %> (Level <%= user.highest_level %>)" >
                          <% user_dad_score = user.current_streak %>
                          <div class="levelOverlay unselectable">
                            <% if user_dad_score != 0 %>
                              <% nextLvl = BadgeMap.where("required_score > :current_score AND challenge_id = :challengeId", {current_score: user_dad_score, challengeId: 1}).order("required_score ASC").first %>
                              <% prevLvl = BadgeMap.where("required_score <= :current_score AND challenge_id = :challengeId", {current_score: user_dad_score, challengeId: 1}).order("required_score DESC").first %>
                              <%= "#{user_dad_score}/#{nextLvl.required_score} to lvl #{nextLvl.prestige}" %>
                            <% else %>
                              No Active Streak
                            <% end %>
                          </div>
                          <div class="progress" >
                            <% barPercent = (user_dad_score == 0) ? 0 : (100.0*(user_dad_score - (prevLvl.blank? ? 0 : prevLvl.required_score)).to_f)/(nextLvl.required_score - (prevLvl.blank? ? 0 : prevLvl.required_score)).to_f %>
                            <div class="progress-bar progress-bar-experience" role="progressbar" style="width: <%= barPercent %>%" aria-valuenow="<%= barPercent %>" aria-valuemin="0" aria-valuemax="100">
                            </div>
                          </div>
                        </div>
                      </span>
                    </a>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-1"></div>
  </div>
</div>
