<% provide(:title, "Do Art Daily") %>

<script>
  // Needed to activate tooltips.
  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })
  $(function () {
    $('[data-toggle="popover"]').popover()
  })

  function pad(n) {
    return (n < 10) ? ("0" + n) : n;
  }
  var interval;
  $(document).ready(function(){
    var seconds, minutes, hours, days;
    
    if (interval != null) {
      clearInterval(interval);
    }
    var timeInfo = $('.time_information').data('time');
   
    var rubyDate = new Date(timeInfo);
    var javascriptDate = Date.now();
    var offset = rubyDate - javascriptDate;
  
    var rubyNextDate = new Date(Date.UTC(rubyDate.getUTCFullYear(), rubyDate.getUTCMonth(), rubyDate.getUTCDate() + 1, 0, 0, 0));
    var rubyNextSubmissionDate = new Date(Date.UTC(rubyDate.getUTCFullYear(), rubyDate.getUTCMonth(), rubyDate.getUTCDate() + $('.time_information').data('daysleft'), 0, 0, 0));
    var currentTime = new Date(offset + Date.now());
    
    var timeToNextDay = rubyNextDate - currentTime;
    var timeToNextSubmissionDate = rubyNextSubmissionDate - currentTime;
    var submitted = $('.time_information').data('submitted')
    
    if (submitted == -2) {
      $('#TimeDisplay').html(currentTime.toUTCString());
      $('#StreakStatus').html("Please log in to view your streak status.");
      $('#StreakStatus').addClass("streakNeutral");
      $('#NextSubmissionDisplay').css("display", "none")
    } else if (submitted == -1) {
      $('#TimeDisplay').html(currentTime.toUTCString());
      $('#StreakStatus').html("You currently don't have an active streak.");
      $('#StreakStatus').addClass("streakNeutral");
      $('#NextSubmissionDisplay').css("display", "none")
    } else {
      $('#TimeDisplay').html(currentTime.toUTCString());
      
      seconds = Math.floor(timeToNextSubmissionDate / (1000)) % 60;
      minutes = Math.floor(timeToNextSubmissionDate / (1000*60)) % 60;
      hours = Math.floor(timeToNextSubmissionDate / (1000*60*60)) % 24;
      days = Math.floor(timeToNextSubmissionDate / (1000*60*60*24));
      
      if (submitted == 0) {
        $('#StreakStatus').html("You must submit soon to protect your streak.<br>");
        $('#StreakStatus').addClass("streakDanger");
        $('#NextSubmissionDisplay').html("Submission Deadline: "+(days ? days+" day(s) " : "")+pad(hours)+":"+pad(minutes)+":"+pad(seconds));
      } else if (submitted == 1) {
        $('#StreakStatus').html("Your streak is safe for now!<br>");
        $('#StreakStatus').addClass("streakSafe");
        $('#NextSubmissionDisplay').html("Next Submission Period: "+(days ? days+" day(s) " : "")+pad(hours)+":"+pad(minutes)+":"+pad(seconds));
      }
      
    }
    
    interval = setInterval(function() {
      currentTime = new Date(offset + Date.now());
      timeToNextDay = rubyNextDate - currentTime;
      var pretext;
      
      if (submitted == -2) {
        $('#TimeDisplay').html(currentTime.toUTCString());
      } else if (submitted == -1) {
        $('#TimeDisplay').html(currentTime.toUTCString());
      } else {
        $('#TimeDisplay').html(currentTime.toUTCString());
        
        if (submitted == 0) {
          $('#StreakStatus').html("You must submit soon to protect your streak.<br>");
          pretext = "Submission Deadline: ";
        } else if (submitted == 1) {
          $('#StreakStatus').html("Your streak is safe for now!<br>");
          pretext = "Next Submission Period: ";
        }
        
        timeToNextSubmissionDate = rubyNextSubmissionDate - currentTime;
        
        if (timeToNextSubmissionDate >= 0) {
          seconds = Math.floor(timeToNextSubmissionDate / (1000)) % 60;
          minutes = Math.floor(timeToNextSubmissionDate / (1000*60)) % 60;
          hours = Math.floor(timeToNextSubmissionDate / (1000*60*60)) % 24;
          days = Math.floor(timeToNextSubmissionDate / (1000*60*60*24));
      
          $('#NextSubmissionDisplay').html(pretext+(days ? days+" day(s) " : "")+pad(hours)+":"+pad(minutes)+":"+pad(seconds));
        } else {
          $('#NextSubmissionDisplay').html(pretext+"00:00:00");
        }
      }
      
    }, 1000);
  });
  <% backgroundImage = getRandomSafeSubmission %>
  window.onload = function(e) {
    document.getElementById("home-dashboard").setAttribute("style", "background: linear-gradient(rgba(0, 0, 8, 0.8), rgba(0, 0, 8, 0.8)), url('<%= backgroundImage.drawing.url unless backgroundImage.blank? %>') no-repeat center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;")
  }
</script>
<div class="container-fluid">
  <div class="row">
    <!-- Spacing Column -->
    <div class="col-lg-1"></div>
    
    <div class="col-lg-10">
      <div class="row">
        <div class="col-md-12">
          <div class="card" id="home-dashboard">
            <div class="dad-title">Welcome to Do Art Daily!</div>
            <div class="dad-subtitle">Today's Updates (<%= SiteStatus.first.current_rollover.strftime("%B %e, %Y") %>)</div>
            <div class="row">
              <div class="col-md-6 col-sm-6 col-xs-6">
                <p class="failure-text section-title">
                  <%= icon('fas', 'skull') %>
                  Eliminations
                </p>
                <hr>
                <p class="success-text section-title">
                  <%= icon('fas', 'arrow-up') %>
                  Level Ups
                </p>
              </div>
              <div class="col-md-6 col-sm-6 col-xs-6">
                <p class="gilded-text section-title">
                  <%= icon('fas', 'award') %>
                  Badges Awarded
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Spacing Column -->
    <div class="col-lg-1"></div>
  </div>
</div>
